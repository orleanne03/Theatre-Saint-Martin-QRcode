<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Théâtre Saint Martin - Réservations</title>

  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 { color: #2563eb; }
    .scene {
      background: #2563eb;
      color: white;
      padding: 10px;
      width: 80%;
      margin: 20px auto;
      border-radius: 8px;
    }
    .row-label {
      grid-column: span 18;
      text-align: left;
      margin: 6px 0;
      font-weight: bold;
      color: #333;
    }
    .seating {
      display: grid;
      grid-template-columns: repeat(18, 1fr); /* 16 sièges + 2 strapontins */
      gap: 4px;
      justify-content: center;
      margin: 0 auto;
      width: fit-content;
    }
    .seat {
      width: 28px;
      height: 28px;
      border-radius: 4px;
      border: 1px solid #ccc;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      background: white;
      user-select: none;
    }
    .seat.selected {
      background: #2563eb;
      border-color: #2563eb;
      color: white;
    }
    .seat.strapontin {
      background: #e5e7eb;
      border-color: #bbb;
      font-size: 9px;
    }
    .seat.strapontin.selected {
      background: #60a5fa;
      border-color: #2563eb;
      color: white;
    }
    form { margin-top: 20px; }
    input {
      padding: 8px;
      margin: 5px;
      font-size: 16px;
    }
    button {
      background: #2563eb;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover { background: #1e4fd8; }

    #confirmation {
      display: none;
      margin-top: 25px;
      padding: 15px;
      border-radius: 8px;
      background: #e0f2fe;
      color: #1e3a8a;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>
  <h1>Théâtre Saint Martin</h1>

  <div class="scene">SCÈNE</div>
  <div class="seating" id="seating"></div>

  <form id="formReservation">
    <input id="nomClient" type="text" placeholder="Nom complet" required>
    <input id="emailClient" type="email" placeholder="Adresse e-mail" required>
    <button type="button" id="boutonReserver">Réserver</button>
  </form>

  <div id="confirmation"></div>

  <script>
    // === Initialisation EmailJS ===
    emailjs.init("TON_PUBLIC_KEY"); // ex: B3xyzA4pPQ12Z

    // === Définition du plan de salle ===
    const seatOrder = [15,13,11,9,7,5,3,1,2,4,6,8,10,12,14,16];
    const letters = "ABCDEFGHIJKLMNOPQRS".split(""); // 19 rangées
    const seating = document.getElementById("seating");

    // Création des rangées (S en haut → A en bas)
    for (let r = letters.length - 1; r >= 0; r--) {
      const rowLetter = letters[r];

      // Étiquette de rangée
      const label = document.createElement("div");
      label.classList.add("row-label");
      label.textContent = "Rangée " + rowLetter;
      seating.appendChild(label);

      // Strapontin gauche
      const left = document.createElement("div");
      left.classList.add("seat", "strapontin");
      left.textContent = "SG";
      left.dataset.id = `${rowLetter}-SG`;
      left.onclick = () => left.classList.toggle("selected");
      seating.appendChild(left);

      // Sièges numérotés
      seatOrder.forEach(num => {
        const seat = document.createElement("div");
        seat.classList.add("seat");
        seat.dataset.id = `${rowLetter}${num}`;
        seat.textContent = num;
        seat.onclick = () => seat.classList.toggle("selected");
        seating.appendChild(seat);
      });

      // Strapontin droit
      const right = document.createElement("div");
      right.classList.add("seat", "strapontin");
      right.textContent = "SD";
      right.dataset.id = `${rowLetter}-SD`;
      right.onclick = () => right.classList.toggle("selected");
      seating.appendChild(right);
    }

    // === Envoi du ticket par e-mail ===
    async function genererTicketEmail(nom, sieges, email) {
      const date = new Date().toLocaleDateString("fr-FR", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
      });

      const ticketHTML = `
        <div style="border:1px solid #2563eb;border-radius:8px;padding:15px;
                    max-width:400px;margin:auto;text-align:left;font-family:sans-serif;">
          <h2 style="color:#2563eb;">Théâtre Saint Martin</h2>
          <p><strong>Nom :</strong> ${nom}</p>
          <p><strong>Date :</strong> ${date}</p>
          <p><strong>Places réservées :</strong> ${sieges.join(", ")}</p>
          <p>Merci pour votre réservation et bon spectacle.</p>
        </div>
      `;

      const params = {
        to_email: email,
        to_name: nom,
        message: ticketHTML
      };

      try {
        const res = await emailjs.send(
          "TON_SERVICE_ID",
          "TON_TEMPLATE_ID",
          params,
          "TON_PUBLIC_KEY"
        );
        console.log("Email envoyé :", res);

        const confirmation = document.getElementById("confirmation");
        confirmation.innerHTML = `
          <h3>Réservation confirmée</h3>
          <p>Merci ${nom}, votre ticket a été envoyé à <strong>${email}</strong>.</p>
          <p>Si vous ne voyez pas le message, vérifiez votre dossier "Courrier indésirable".</p>
        `;
        confirmation.style.display = "block";

      } catch (err) {
        console.error("Erreur EmailJS :", err);
        alert("Erreur EmailJS : " + (err.text || err.message));
      }
    }

    // === Clic sur "Réserver" ===
    document.getElementById("boutonReserver").onclick = async () => {
      const nom = document.getElementById("nomClient").value.trim();
      const email = document.getElementById("emailClient").value.trim();
      const siegesSelectionnes = Array.from(document.querySelectorAll(".seat.selected"))
        .map(s => s.dataset.id);

      if (!nom || !email || siegesSelectionnes.length === 0) {
        alert("Merci de remplir tous les champs et de choisir au moins un siège.");
        return;
      }

      await genererTicketEmail(nom, siegesSelectionnes, email);
    };
  </script>
</body>
</html>
