<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Théâtre Saint Martin - Réservations</title>

  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 { color: #2563eb; }
    .scene {
      background: #2563eb;
      color: white;
      padding: 10px;
      width: 60%;
      margin: 20px auto;
      border-radius: 8px;
    }
    .seating {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 5px;
      justify-content: center;
      margin: 0 auto;
      width: fit-content;
    }
    .seat {
      width: 30px;
      height: 30px;
      border-radius: 4px;
      border: 1px solid #ccc;
      cursor: pointer;
    }
    .seat.selected {
      background: #2563eb;
      border-color: #2563eb;
    }
    form { margin-top: 20px; }
    input {
      padding: 8px;
      margin: 5px;
      font-size: 16px;
    }
    button {
      background: #2563eb;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover { background: #1e4fd8; }

    /* Confirmation */
    #confirmation {
      display: none;
      margin-top: 25px;
      padding: 15px;
      border-radius: 8px;
      background: #e0f2fe;
      color: #1e3a8a;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>
  <h1>Théâtre Saint Martin</h1>

  <div class="scene">SCÈNE</div>
  <div class="seating" id="seating"></div>

  <form id="formReservation">
    <input id="nomClient" type="text" placeholder="Nom complet" required>
    <input id="emailClient" type="email" placeholder="Adresse e-mail" required>
    <button type="button" id="boutonReserver">Réserver</button>
  </form>

  <div id="confirmation"></div>

  <script>
    // === Initialisation EmailJS ===
    emailjs.init("TON_PUBLIC_KEY"); // ex: B3xyzA4pPQ12Z

    // === Création des sièges ===
    const nbRows = 5;
    const nbSeatsPerRow = 10;
    const seating = document.getElementById("seating");

    for (let r = 1; r <= nbRows; r++) {
      for (let c = 1; c <= nbSeatsPerRow; c++) {
        const seat = document.createElement("div");
        seat.classList.add("seat");
        seat.dataset.id = `R${r}-S${c}`;
        seat.onclick = () => seat.classList.toggle("selected");
        seating.appendChild(seat);
      }
    }

    // === Fonction d’envoi du ticket par e-mail ===
    async function genererTicketEmail(nom, sieges, email) {
      const date = new Date().toLocaleDateString("fr-FR", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
      });

      const ticketHTML = `
        <div style="border:1px solid #2563eb;border-radius:8px;padding:15px;
                    max-width:400px;margin:auto;text-align:left;font-family:sans-serif;">
          <h2 style="color:#2563eb;">Théâtre Saint Martin</h2>
          <p><strong>Nom :</strong> ${nom}</p>
          <p><strong>Date :</strong> ${date}</p>
          <p><strong>Sièges réservés :</strong> ${sieges.join(", ")}</p>
          <p>Merci pour votre réservation et bon spectacle.</p>
        </div>
      `;

      const params = {
        to_email: email,
        to_name: nom,
        message: ticketHTML
      };

      try {
        const res = await emailjs.send(
          "TON_SERVICE_ID",   // ex: service_123abc
          "TON_TEMPLATE_ID",  // ex: template_456xyz
          params,
          "TON_PUBLIC_KEY"
        );
        console.log("Email envoyé :", res);

        // --- Affiche confirmation visuelle ---
        const confirmation = document.getElementById("confirmation");
        confirmation.innerHTML = `
          <h3>Réservation confirmée</h3>
          <p>Merci ${nom}, votre ticket a été envoyé à <strong>${email}</strong>.</p>
          <p>Si vous ne voyez pas le message, vérifiez votre dossier "Courrier indésirable".</p>
        `;
        confirmation.style.display = "block";

      } catch (err) {
        console.error("Erreur EmailJS :", err);
        alert("Erreur EmailJS : " + (err.text || err.message));
      }
    }

    // === Clic sur "Réserver" ===
    document.getElementById("boutonReserver").onclick = async () => {
      const nom = document.getElementById("nomClient").value.trim();
      const email = document.getElementById("emailClient").value.trim();
      const siegesSelectionnes = Array.from(document.querySelectorAll(".seat.selected"))
        .map(s => s.dataset.id);

      if (!nom || !email || siegesSelectionnes.length === 0) {
        alert("Merci de remplir tous les champs et de choisir au moins un siège.");
        return;
      }

      await genererTicketEmail(nom, siegesSelectionnes, email);
    };
  </script>
</body>
</html>
